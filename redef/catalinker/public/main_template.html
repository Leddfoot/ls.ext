<div class="content"
     data-automation-id="targetresources-uris"
     data-work-uri="{{targetUri.Work}}"
     data-publication-uri="{{targetUri.Publication}}"
     data-person-uri="{{targetUri.Person}}"
     decorator="clickOutsideSupportPanelDetector">
    <h2 data-automation-id="page-heading">Katalogisering av utgivelse</h2>

    <div class="grid-input">
        <div class="pure-g" style="height: 0px;">
            <div class="pure-u-1-2" id="left-dummy-panel"/>
            <div class="pure-u-1-2" id="right-dummy-panel"/>
        </div>
        <ul class="grid-tabs pure-g" id="workflow-tabs">
            {{#each inputGroups}}
            <li class="grid-tab pure-u">
                <a class="{{tabSelected ? 'grid-tab-link-selected' : ''}} grid-tab-link {{#tabEnabled(tabSelected,domain)}}{{else}}disabled{{/}}"
                   id="{{tabId}}-tab"
                   data-toggle="tab" role="tab" on-click="{{#tabEnabled(tabSelected,domain)}}activateTab{{/}}">{{tabLabel}}</a>
            </li>
            {{/each}}
        </ul>
        <div class="grid-content tab-content">
            <div class="inner-content">
                {{#each inputGroups}}
                <div id="{{tabId}}" class="grid-panel {{tabSelected ? 'grid-panel-selected' : ''}} pure-g">
                    {{#each inputs}}
                    {{#visible}}
                    {{>input}}
                    {{/visible}}
                    {{/each}}
                    <div class="pure-u-1-2">
                        {{#nextStep}}
                        <button class="pure-button pure-button-primary next-step-button"
                                disabled="{{!nextStepEnabled(domain)}}" on-click="nextStep:{{.}}">{{buttonLabel}}
                        </button>
                        {{/nextStep}}
                    </div>
                </div>
                {{/each}}
            </div>
            <div class="pure-g links">
                {{#targetUri.Work}}
                <div class="pure-u-1">
                    <a data-automation-id="work_page_link" target="_blank"
                       href="{{targetUri.Work.replace(':8005', ':8000')}}">Vis siden for verket</a>
                </div>
                {{/}}
                {{#targetUri.Publication}}
                <div class="pure-u-1">
                    <a data-automation-id="biblio_record_link" target="_blank"
                       href="{{config.kohaIntraUri}}/cgi-bin/koha/catalogue/detail.pl?biblionumber={{publicationId()}}"
                       class="link">Vis utgivelsen i Koha</a>
                </div>
                {{/}}
            </div>
        </div>
    </div>
</div>
<div class="footer">
    <div id="errors">{{#errors}}<p>{{.}}</p>{{/errors}}</div>
    <div id="save-stat">{{save_status}}</div>
</div>

{{#partial input}}
<div class="input-panel pure-u-1-1 prop-input" decorator="repositionSupportPanel" {{#if resourceIsLoaded(showOnlyWhenEmpty) }} style="display:none;" {{/if}}>
    <div class="pure-u-1-2 label {{firstInGroup ? 'first':''}} panel-part"
         data-uri-escaped-label="{{encodeURI(label)}}">{{label}}
    </div>
    <span class="panel-part pure-u-1-2 {{lastInGroup ? 'last':''}}">
        {{#each values:index}}
        <span class="field pure-u-1-1" id="support_panel_base_{{uniqueId}}">
            {{>type}}
            {{#predicate === (config.ontologyUri + "#recordID") && current.value !== ""}}
            <a data-automation-id="biblio_record_link" target="_blank"
               href="{{config.kohaIntraUri}}/cgi-bin/koha/catalogue/detail.pl?biblionumber={{current.value}}"
               class="link"></a>
            {{/}}
            {{#predicate === (config.ontologyUri + "#publicationOf") && current.value !== ""}}
            <a data-automation-id="work_page_link" target="_blank" href="{{current.value.replace(':8005',':8000')}}"
               class="link"></a>
            {{/}}
            <div class="invalid-msg">{{#error}}{{error}}{{/error}}</div>
        </span>
        {{#index == values.length -1}}
        <span class="support-panel" data-support-panel-base-ref="support_panel_base_{{uniqueId}}">
            {{>"support-for-"+type}}
        </span>
        {{/}}
        {{/each}}
    {{#if subInputs}}
    {{#each subInputs[0].input.values:inputValueIndex}}
        <span class="pure-u-1-1 field {{#if cssClassPrefix}}{{cssClassPrefix}}-{{nonEditable ? 'non-' :''}}editable{{/if}}"
              {{#if
              nonEditable}}disabled="disabled" {{/if}}>
            {{#if nonEditable}}
            <a class="delete" title="Slett oppføring"
               on-click="deleteObject:{{../../../input.parentInput}},{{inputValueIndex}}"></a>
            {{/if}}
            <span class="input-wapper">
                <span class="inputs">
                    {{#each ../../../../../subInputs}}
                        <span class="input {{#if !nonEditable}}pure-u-1-1{{/if}}">
                            <span class="label {{#if !nonEditable}}pure-u-1-1{{/if}}"
                                  data-uri-escaped-label="{{encodeURI(label)}}">{{label}}</span>
                            {{#with input.values[inputValueIndex]}}
                                <span class="value sub-field" id="support_panel_base_{{uniqueId}}">
                                    {{>../../../input.type}}
                                </span>
                                {{#if ! nonEditable }}
                                    <span class="support-panel" data-support-panel-base-ref="support_panel_base_{{uniqueId}}">
                                        {{#with ../../../input}}
                                        {{>"support-for-"+type}}
                                        {{/with}}
                                    </span>
                                {{/if}}
                            {{/with}}
                            <span class="invalid-msg {{#if !nonEditable}}pure-u-1-1{{/if}}">{{#error}}{{error}}{{/error}}</span>
                        </span>
                    {{/each}}
                </span>
                <span class="subject-type-association">
                    <span class="{{#if !nonEditable}}pure-u-1-1{{/if}}">
                        {{#with ../../../parentInput}}
                            {{#if ! nonEditable }}
                                {{#subjectTypes}}
                                    <span class="subject-type-select" {{#if (subjectTypes.length== 1) }} style="display:none" {{/if}}>
                                        <input type="radio" name={{subjectType}} value="{{.}}"
                                               {{# !
                                               targetUri[.]}}title='Denne knytningen kan ikke velges før tilhørende ressurstype er lastet'
                                               disabled='disabled' {{/}}/>
                                        <label>{{subjectTypeLabel(.)}}</label>
                                    </span>
                                {{/subjectTypes}}
                                <div>
                                    <a class="pure-button pure-button-primary add-item-button"
                                       {{#if typeof subjectType=== 'undefined' || values.length == 0 || (!resourceIsLoaded(subjectType))}}disabled{{/if}}
                                    {{#if !resourceIsLoaded(subjectType)}}title="Kan ikke legge til før {{subjectTypeLabelDet(subjectType)}} er lastet"{{/if}}
                                       on-click="saveObject:{{inputValueIndex}}">Legg til</a>
                                </div>
                            {{/if}}
                        {{/with}}

                        {{#if nonEditable}}
                            {{subjectTypeLabelDet(subjectType)}}
                        {{/if}}
                    </span>
                </span>
            </span>
        </span>
    {{/each}}
    {{/if}}
    {{#multiple && allowAddNewButton}}
    <span class="pure-u-1-1">
        <div class="add-new-btn-row">
            <div class="pure-u-2-3"> </div>
            <a class="pure-u-1-3 pure-button pure-button-primary" on-click="addValue">Legg til ny</a>
        </div>
    </span>
    {{/}}
</div>
{{/partial}}

{{#partial support-for-searchable-with-result-in-side-panel}}
{{#searchResult}}
<div class="prop-search-results support-panel-content">
    <form action="">
        {{#!widgetOptions.enableCreateNewResource.showCreateInputs}}
        {{#if items}}
        {{#each items:itemIndex}}
        <div class="search-result pure-g" data-automation-id="{{uri}}">
            <div class="pure-u-1">
                <div class="pure-g">
                    <div class="pure-u-1-12">
                        <input class="select-result-item-radio" type="radio"
                               on-click="selectSearchableItem:{{origin}},{{.[config.search[selectedIndexType].resultItemLabelProperty]}}"
                               checked="{{isChecked}}"/>
                    </div>
                    <div class="pure-u-5-6">
                        <p class="subitem-label">{{.[config.search[selectedIndexType].resultItemLabelProperty]}}</p>
                    </div>

                    <div class="pure-u-1-12">
                        {{#work.length || loadWorksAsSubjectOfItem}}
                        <span class="toggle-show-works" on-click="toggleWork:{{loadWorksAsSubjectOfItem}},{{.}}">{{#toggleWork}}&#x25B2;{{else}}&#x25BC;{{/toggleWork}}</span>{{/}}
                    </div>
                    {{>"additional-search-result-item-info-for-"+selectedIndexType}}
                    {{#toggleWork}}
                    <div class="work-items pure-u-1">
                        {{#work}}
                        <div class="search-result-subitem pure-g">
                            {{>work}}
                            {{# widgetOptions.showSelectWork}}
                        <span class="search-result-work-selector pure-u-2-24">
                            <input class="select-work-radio" type="radio" checked="{{isChecked}}"
                                   on-click="setResourceAndWorkResource:{{items[itemIndex]}},{{origin}},'Person'"/>
                        </span>
                            {{/}}
                        </div>
                        {{/work}}
                    </div>
                    {{/toggleWork}}
                </div>
            </div>
            {{/each}}
            {{else}}
            <div class="search-result pure-g">
                <div class="pure-u-1">
                    Ingen treff
                </div>
            </div>
            {{/if}}
            {{/}}
            {{#widgetOptions.enableCreateNewResource.forms[selectedIndexType]}}
                <div class="search-result pure-u-1" {{#if widgetOptions.enableCreateNewResource.showCreateInputs}}style="display: none;"{{/if}}>
                    <span class="pure-u-1-1">
                        <div class="add-new-btn-row">
                            <div class="pure-u-2-3"> </div>
                            <a on-click="showCreateNewResource:{{origin}}" class="pure-u-1-3 pure-button pure-button-primary">Legg til ny</a>
                        </div>
                    </span>
                </div>

                {{#if widgetOptions.enableCreateNewResource.showCreateInputs}}
                    <div class="search-result pure-u-1">
                        {{#each inputs}}
                        {{./label}}:
                        {{#each values}}
                        <span class="field pure-u-1-1">
                            {{>type}}
                        </span>
                        {{/each}}
                        {{/each}}
                        <span class="pure-u-1-1">
                            <div class="add-new-btn-row">
                                <div class="pure-u-2-3"> </div>
                                <a class="pure-u-1-3 pure-button pure-button-primary"
                                   on-click="createNewResource:{{origin}}">Legg til</a>
                            </div>
                        </span>
                    </div>
                {{/if}}
            {{/if}}
    </form>
</div>
{{/searchResult}}
{{/partial}}

{{#partial work}}
<div class="work-name pure-u-22-24">
    <span class="pure-u-23-24">{{inPreferredLanguage(mainTitle)}}</span>
    {{#partTitle}}
    <span class="pure-u-1-24"/>
    <span class="part-name pure-u-21-22">{{inPreferredLanguage(partTitle)}}</span>
    {{/}}
</div>
{{/partial}}

{{#partial additional-search-result-item-info-for-person}}
<div class="pure-g">
    <div class="pure-u-1-12"></div>
    <div class="pure-u-9-12">
        <small><span class="birth-and-death">{{#birthYear}}f. <span
                class="birthYear">{{birthYear}}</span> - {{#deathYear}}d. <span
                class="deathYear">{{deathYear}}</span>{{/death}}{{/birthYear}}</span></small>
    </div>
</div>
{{/partal}}

{{#partial select-predefined-value}}
<span data-automation-id="{{../../dataAutomationId}}" {{#if ! nonEditable}}class="pure-u-1-1"{{/if}}>
    {{#if nonEditable}}
    <span>{{predefinedLabelValue(../../fragment, ./current.value[0])}}</span>
    {{/if}}
    <span style="{{#if nonEditable}}display:none;{{/if}}">
        <select
                class="authorized" style="width: 100%;"
                {{#if nonEditable}}disabled{{/if}}
            decorator="multi:{select2:[{{#!multiple}}'singleSelect'{{/multiple}}], detectChange:[], handleAddNewBySelect2:[]}"
            data-automation-id="{{dataAutomationId}}"
            multiple>
            {{#each predefinedValues[../../fragment]}}
            <option value='{{.["@id"]}}'>{{getRdfsLabelValue(.["rdfs:label"])}}</option>
            {{/each}}
        </select>
    </span>
</span>
{{/partial}}

{{#partial input-string}}
<input {{#disabled}} disabled="true" {{/}}
class="pure-u-1-1 {{#error}}invalid-input{{else}}valid{{/error}}"
on-blur='patchResource:{{predicate}},{{rdfType}}'
data-automation-id="{{../../dataAutomationId}}"
value="{{current.value}}" />
{{/partial}}

{{#partial searchable-with-result-in-side-panel}}
<span data-automation-id="{{../../dataAutomationId}}" {{#if ! nonEditable}}class="pure-u-1-1"{{/if}}>
    {{#if nonEditable}}{{current.displayValue}}{{else}}
    {{#if ../../indexTypes.length > 1 && !deletable}}
    <span class="index-type-select pure-u-1-2">
        <select value="{{../../selectedIndexType}}">
            {{#with widgetOptions.selectIndexTypeLegend}}
                <option disabled selected>{{.}}</option>
            {{/with}}
            {{#each ../../indexTypes}}
            <option value="{{.}}">{{config.search[.].selectIndexLabel}}</option>
            {{/each}}
        </select>
    </span>
    {{/if}}
    <input {{#deletable}}readonly {{/deletable}} type="search"
    on-click="{{#deletable}}unselectEntity{{/deletable}}"
    class="pure-u-22-24 {{#error}}invalid-input{{else}}valid{{/error}}{{#deletable}} deletable{{/deletable}}{{#if searchable}} searchable{{/if}}"
    data-automation-id="{{dataAutomationId}}"
    on-enter='searchResource:{{./current.displayValue}},{{../../selectedIndexType}},{{loadWorksAsSubjectOfItem}}'
    on-keyup='searchResource:{{./current.displayValue}},{{../../selectedIndexType}},{{loadWorksAsSubjectOfItem}}'
    value="{{current.displayValue}}" />
    <span class="support-panel-expander" on-click='searchResource:{{current.displayValue}}'> </span>
    {{/if}}
</span>
{{/partial}}

{{#partial input-lang-string}}
<span data-automation-id="{{../../dataAutomationId}}_{{@index}}">
    <input {{#disabled}} disabled="true" {{/}}
    class="pure-u-1-1 {{#error}}invalid-input{{else}}valid{{/error}}"
    on-blur='patchResource:{{predicate}},{{rdfType}}'
    data-automation-id="{{../../dataAutomationId}}"
    value="{{current.value}}" />
    <select value="{{current.lang}}" on-change='patchResource:{{predicate}},' class="select_lang">
        <option value="">velg språk</option>
        <option value="no">norsk</option>
        <option value="en">engelsk</option>
        <option value="fr">fransk</option>
    </select>
</span>
{{/partial}}

{{#partial input-gYear}}
<input {{#disabled}} disabled="true" {{/}}
class="pure-u-1-2 {{#error}}invalid-input{{else}}valid{{/error}}"
on-blur='patchResource:{{predicate}},{{rdfType}}'
data-automation-id="{{dataAutomationId}}"
value="{{current.value}}" />
{{/partial}}

{{#partial input-nonNegativeInteger}}
{{#if nonEditable}}
<span data-automation-id="{{../../dataAutomationId}}">{{./current.value}}</span>
{{else}}
<input {{#disabled}} disabled="true" {{/}}
class="pure-u-1-1 {{#error}}invalid-input{{else}}valid{{/error}}"
on-blur='patchResource:{{predicate}},{{rdfType}}'
data-automation-id="{{../../dataAutomationId}}"
value="{{./current.value}}" />
{{/if}}
{{/partial}}

{{#partial searchable-authority-dropdown}}
<span data-automation-id="{{../../dataAutomationId}}">
    {{#if nonEditable}}
    <span>{{authorityLabels[urlEscape(current.value[0])]}}</span>
    {{else}}
            <select style="width: 100%;"
                    decorator="multi:{select2:['authoritySelectSingle'], detectChange:[]}" id="sel_{{uniqueId}}"
                    class="searchable-authority" multiple>
        {{#if current.value[0]}}
        <option value='{{current.value[0]}}' selected="selected">{{current.displayName}}</option>
        {{/if}}
    </select>
    {{/if}}
</span>
{{/partial}}
